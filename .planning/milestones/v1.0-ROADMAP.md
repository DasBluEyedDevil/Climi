# Milestone v1.0: Multi-Agent-Workflow

**Status:** SHIPPED 2026-02-05
**Phases:** 1-7
**Total Plans:** 15

## Overview

This roadmap delivered a Claude Code plugin that integrates Kimi CLI as an autonomous R&D subagent. The journey started with a core wrapper script that can invoke Kimi with role-based agent files, built out the full role library and prompt assembly features, added Claude Code slash commands for seamless delegation, and finished with cross-platform distribution. Each phase delivered a testable capability -- the wrapper works end-to-end after Phase 1, gains real agent personas in Phase 2, becomes a power tool in Phases 3-4, integrates into Claude's workflow in Phase 5, and ships to users in Phase 6. Phase 7 was a gap closure to fix a critical installer bug.

## Phases

### Phase 1: Core Wrapper

**Goal**: A working wrapper script that invokes Kimi CLI with a selected agent role and validates the CLI environment
**Depends on**: Nothing (first phase)
**Requirements**: WRAP-01, WRAP-02, WRAP-03, WRAP-08, WRAP-10, WRAP-12, WRAP-13
**Plans**: 1 plan

Plans:
- [x] 01-01-PLAN.md -- Complete wrapper script with CLI validation, arg parsing, role resolution, invocation, and smoke tests

**Details:**
- 282-line bash script (`skills/kimi.agent.wrapper.sh`)
- CLI detection via KIMI_PATH env var (Windows workaround) then PATH lookup
- Version validation against minimum 1.7.0 (warns, doesn't block)
- Two-tier agent resolution: project-local first, then global install
- Exit codes 10-13 for wrapper errors, 1-9 reserved for kimi CLI propagation

### Phase 2: Agent Roles

**Goal**: Users can delegate to specialized Kimi agents -- reviewers that only read, debuggers that can write and execute -- each with structured output
**Depends on**: Phase 1
**Requirements**: ROLE-01, ROLE-02, ROLE-03, ROLE-04, ROLE-05, ROLE-06, ROLE-07, ROLE-08, ROLE-09, ROLE-10, ROLE-11
**Plans**: 3 plans in 3 waves

Plans:
- [x] 02-01-PLAN.md -- Create 3 analysis role agents (reviewer, security, auditor) with read-only tool access
- [x] 02-02-PLAN.md -- Create 4 action role agents (debugger, refactorer, implementer, simplifier) with full tool access
- [x] 02-03-PLAN.md -- Verify all 7 agent configurations work correctly (syntax, invocation, tool restrictions, output format)

**Details:**
- 7 specialized roles: reviewer, security, auditor (analysis), debugger, refactorer, implementer, simplifier (action)
- Analysis roles use `exclude_tools` for read-only enforcement
- All roles produce structured output: SUMMARY / FILES / ANALYSIS / RECOMMENDATIONS
- YAML + companion markdown system prompt per role

### Phase 3: Prompt Assembly

**Goal**: Users can enrich Kimi invocations with templates, git diffs, and project context without manual prompt construction
**Depends on**: Phase 1
**Requirements**: WRAP-04, WRAP-05, WRAP-06, WRAP-07
**Plans**: 3 plans

Plans:
- [x] 03-01-PLAN.md -- Template-based prompt prepending with 6 built-in templates (feature, bug, verify, architecture, implement-ready, fix-ready)
- [x] 03-02-PLAN.md -- Git diff injection (--diff flag) and context file auto-loading (.kimi/context.md, KimiContext.md)
- [x] 03-03-PLAN.md -- Comprehensive verification of all prompt assembly features with documented test evidence

**Details:**
- 6 built-in templates: feature, bug, verify, architecture, implement-ready, fix-ready
- Git diff injection via `--diff` flag captures staged + unstaged changes
- Context file auto-loading: .kimi/context.md first, KimiContext.md fallback
- Machine-parseable header extended to [kimi:role:template:model]

### Phase 4: Developer Experience

**Goal**: Users can debug wrapper behavior, preview commands, access help, and activate deep thinking mode
**Depends on**: Phase 1, Phase 3
**Requirements**: WRAP-09, WRAP-11, WRAP-14, WRAP-15
**Plans**: 2 plans in 1 wave (parallel)

Plans:
- [x] 04-01-PLAN.md -- Enhanced help output with dynamic role/template enumeration and thinking flag documentation
- [x] 04-02-PLAN.md -- Verbose mode and dry-run mode for debugging wrapper behavior

**Details:**
- `--dry-run` shows exact command without executing
- `--verbose` shows detailed execution steps
- `-h/--help` documents all flags with dynamic role/template enumeration
- `--thinking` passes through for deeper analysis

### Phase 5: Claude Code Integration

**Goal**: Claude Code users can delegate work to Kimi via slash commands, and Claude knows when and how to invoke Kimi autonomously
**Depends on**: Phase 1, Phase 2, Phase 3, Phase 4
**Requirements**: INTG-01, INTG-02, INTG-03, INTG-04, INTG-05, INTG-06
**Plans**: 2 plans in 1 wave (parallel)

Plans:
- [x] 05-01-PLAN.md -- Create 4 slash commands (/kimi-analyze, /kimi-audit, /kimi-trace, /kimi-verify)
- [x] 05-02-PLAN.md -- Create SKILL.md (<3000 chars) and CLAUDE.md.kimi-section template

**Details:**
- 4 slash commands: /kimi-analyze, /kimi-audit, /kimi-trace, /kimi-verify
- SKILL.md under 3,000 chars teaching Claude delegation patterns
- CLAUDE.md section template for users to add to their projects

### Phase 6: Distribution

**Goal**: Users can install the entire plugin by cloning the repo and running one command, on any platform
**Depends on**: Phase 1, Phase 2, Phase 3, Phase 4, Phase 5
**Requirements**: DIST-01, DIST-02, DIST-03, DIST-04, DIST-05, DIST-06, DIST-07
**Plans**: 3 plans in 2 waves

Plans:
- [x] 06-01-PLAN.md -- Create install.sh and uninstall.sh with multi-target support
- [x] 06-02-PLAN.md -- Create kimi.ps1 PowerShell shim for Windows
- [x] 06-03-PLAN.md -- Create comprehensive README.md documentation

**Details:**
- install.sh supports global (~/.claude/), project-local, and custom targets
- Backup before upgrade, dry-run preview, CLI argument parsing
- uninstall.sh with selective removal (Kimi only, Gemini only, everything)
- PowerShell shim with Bash resolution: Git Bash > WSL > MSYS2 > Cygwin > PATH
- 486-line README with installation, quick start, role descriptions, architecture

### Phase 7: Fix Installer Agent MD (Gap Closure)

**Goal**: Agent system prompt MD files are copied during installation so role invocation works post-install
**Depends on**: Phase 6
**Requirements**: N/A (gap closure from milestone audit)
**Plans**: 1 plan

Plans:
- [x] 07-01-PLAN.md -- Add agent MD file copying to install.sh

**Details:**
- Added cp command for .kimi/agents/*.md files after existing YAML copy block
- Closes critical gap: post-install role invocation now works without "file not found" errors
- Commit: a1144ec

---

## Milestone Summary

**Decimal Phases:** None

**Key Decisions:**
- Exit codes 10-13 for wrapper errors; 1-9 reserved for kimi CLI propagation
- Default model is kimi-for-coding (inherits user's kimi config mapping)
- Analysis roles exclude: Shell, WriteFile, StrReplaceFile, SetTodoList, CreateSubagent, Task
- Action roles have NO exclude_tools (full read/write/execute access)
- Bash resolution order on Windows: Git Bash > WSL > MSYS2 > Cygwin > PATH
- Extended existing install.sh/uninstall.sh (supports both Gemini and Kimi)

**Issues Resolved:**
- Windows PATH loss after system updates — addressed with KIMI_PATH env var override
- Kimi CLI version instability — addressed with version check on startup (warns, not blocks)
- Missing agent MD files after installation — fixed in Phase 7 gap closure

**Issues Deferred:** None

**Technical Debt Incurred:** None

---

*For current project status, see .planning/ROADMAP.md*
*Archived: 2026-02-05 as part of v1.0 milestone completion*
