---
phase: 11-integration-distribution
plan: 03
type: execute
wave: 2
depends_on: [11-02]
files_modified:
  - .claude/commands/kimi/kimi-mcp.md
  - .claude/commands/kimi/kimi-hooks.md
autonomous: true

must_haves:
  truths:
    - kimi-mcp.md command file exists with complete documentation
    - kimi-hooks.md command file exists with complete documentation
    - Both commands have usage examples
    - Both commands explain when to use them
  artifacts:
    - path: .claude/commands/kimi/kimi-mcp.md
      provides: MCP slash command documentation
      min_lines: 80
    - path: .claude/commands/kimi/kimi-hooks.md
      provides: Hooks slash command documentation
      min_lines: 80
  key_links:
    - from: kimi-mcp.md
      to: mcp-bridge/bin/kimi-mcp-server
      via: command reference
    - from: kimi-hooks.md
      to: hooks/lib/install.sh
      via: command reference
---

<objective>
Create slash command documentation for /kimi-mcp and /kimi-hooks commands.

Purpose: Enable Claude Code users to invoke MCP server operations and git hooks management via slash commands.
Output: Two complete slash command files with usage examples, options, and troubleshooting.
</objective>

<execution_context>
@~/.config/opencode/get-shit-done/workflows/execute-plan.md
@~/.config/opencode/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/REQUIREMENTS.md

# Existing slash commands for reference
@.claude/commands/kimi/kimi-analyze.md

# MCP implementation reference
@.planning/phases/08-mcp-bridge/08-05-SUMMARY.md
@mcp-bridge/bin/kimi-mcp-server
@bin/kimi-mcp

# Hooks implementation reference
@.planning/phases/09-hooks-system/09-04-SUMMARY.md
@hooks/lib/install.sh
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create kimi-mcp.md slash command</name>
  <files>.claude/commands/kimi/kimi-mcp.md</files>
  <action>
Create .claude/commands/kimi/kimi-mcp.md following the pattern of existing slash commands:

```markdown
# Kimi MCP

Manage the Kimi MCP server for external tool integration.

## Usage

```
/kimi-mcp [action] [options]
```

## Actions

### start
Start the MCP server (reads JSON-RPC from stdin).

```
/kimi-mcp start
```

**What it does:**
1. Starts the MCP server process
2. Listens for JSON-RPC messages on stdin
3. Exposes Kimi as callable tools for external systems
4. Responds with JSON-RPC on stdout

**Use when:**
- External AI systems need to invoke Kimi
- Building MCP client integrations
- Testing MCP tool calls

**Example workflow:**
```bash
# Terminal 1: Start server
echo '{"jsonrpc":"2.0","id":1,"method":"tools/list"}' | kimi-mcp start

# Or interactively
kimi-mcp start
# Then type JSON-RPC requests
```

### setup
Configure MCP for Claude Code or other clients.

```
/kimi-mcp setup [--claude]
```

**Options:**
- `--claude` - Configure specifically for Claude Code integration

**What it does:**
1. Creates MCP configuration file
2. Registers Kimi tools with the client
3. Sets up default roles and timeouts

### status
Check MCP server and configuration status.

```
/kimi-mcp status
```

**Shows:**
- Server binary location
- Configuration file status
- Available tools
- Default settings

## MCP Tools

When running, the server exposes these tools:

| Tool | Purpose | Input |
|------|---------|-------|
| `kimi_analyze` | Analyze code/files | `{ "prompt": "...", "files": [...] }` |
| `kimi_implement` | Implement features | `{ "prompt": "...", "files": [...] }` |
| `kimi_refactor` | Refactor code | `{ "prompt": "...", "files": [...] }` |
| `kimi_verify` | Verify changes | `{ "prompt": "...", "files": [...] }` |

## Configuration

**Config file:** `~/.config/kimi-mcp/config.json`

```json
{
  "model": "k2",
  "timeout": 300,
  "roles": {
    "analyze": "reviewer",
    "implement": "implementer",
    "refactor": "refactorer",
    "verify": "reviewer"
  }
}
```

**Environment variables:**
- `KIMI_MCP_MODEL` - Default model (k2 or k2.5)
- `KIMI_MCP_TIMEOUT` - Timeout in seconds

## Examples

### Test MCP server

```
/kimi-mcp start
```

Then paste:
```json
{"jsonrpc":"2.0","id":1,"method":"initialize","params":{"protocolVersion":"2025-11-25","capabilities":{},"clientInfo":{"name":"test","version":"1.0.0"}}}
```

### Setup for Claude Code

```
/kimi-mcp setup --claude
```

### Check status

```
/kimi-mcp status
```

## Troubleshooting

**"kimi-mcp: command not found"**
- Ensure `~/.local/bin` is in PATH
- Run: `export PATH="$HOME/.local/bin:$PATH"`

**"jq: command not found"**
- MCP server requires jq for JSON processing
- Install: `brew install jq` (macOS) or `apt-get install jq` (Linux)

**Server not responding**
- Check that input is valid JSON-RPC
- Ensure proper newline termination
- Verify protocol version matches

## Protocol

Implements MCP (Model Context Protocol) version 2025-11-25.

**Transport:** stdio (JSON-RPC 2.0)

**Methods:**
- `initialize` - Client/server handshake
- `tools/list` - List available tools
- `tools/call` - Invoke a tool

## See Also

- @.claude/CLAUDE.md — Complete command reference
- @.claude/skills/kimi-delegation/SKILL.md — Delegation patterns
```

Ensure:
1. Follows same structure as kimi-analyze.md
2. All actions are documented
3. Configuration options are explained
4. Troubleshooting covers common issues
5. Protocol version is correct (2025-11-25)
  </action>
  <verify>[ -f .claude/commands/kimi/kimi-mcp.md ] && grep -q "kimi_analyze" .claude/commands/kimi/kimi-mcp.md && grep -q "2025-11-25" .claude/commands/kimi/kimi-mcp.md</verify>
  <done>kimi-mcp.md created with complete MCP command documentation</done>
</task>

<task type="auto">
  <name>Task 2: Create kimi-hooks.md slash command</name>
  <files>.claude/commands/kimi/kimi-hooks.md</files>
  <action>
Create .claude/commands/kimi/kimi-hooks.md:

```markdown
# Kimi Hooks

Manage git hooks for automatic Kimi delegation.

## Usage

```
/kimi-hooks [action] [options]
```

## Actions

### install
Install git hooks to enable auto-delegation.

```
/kimi-hooks install [--global] [--local]
```

**Options:**
- `--global` - Install to `~/.config/git/hooks/` (affects all repos)
- `--local` - Install to current repo's `.git/hooks/` (default)

**What it does:**
1. Creates hook scripts in the target directory
2. Sets up `.kimi/hooks.json` configuration
3. Backs up existing hooks
4. Makes hooks executable

**Installed hooks:**
- `pre-commit` - Auto-format and lint fixes before commit
- `post-checkout` - Analyze changed files after branch checkout
- `pre-push` - Run tests and fix failures before push

**Use when:**
- Setting up a new project with auto-delegation
- Want automatic code fixes on commit
- Need pre-push validation

### uninstall
Remove Kimi hooks.

```
/kimi-hooks uninstall [--global] [--local]
```

**Restores:** Original hooks from backup if available.

### status
Check hook installation status.

```
/kimi-hooks status
```

**Shows:**
- Which hooks are installed (global vs local)
- Hook configuration file location
- Enablement status for each hook
- Last run information

## Hook Behavior

### Pre-commit
Runs before each commit.

**Actions:**
1. Stashes unstaged changes
2. Runs auto-formatting on staged files
3. Runs linting and auto-fixes
4. Restores stashed changes

**Configuration:**
```json
{
  "pre_commit": {
    "enabled": true,
    "auto_fix": true,
    "max_file_size_kb": 100
  }
}
```

### Post-checkout
Runs after `git checkout` or `git switch`.

**Actions:**
1. Detects files changed in checkout
2. Analyzes for potential issues
3. Reports findings

**Configuration:**
```json
{
  "post_checkout": {
    "enabled": true,
    "max_files": 10,
    "analyze_patterns": ["*.js", "*.ts", "*.py"]
  }
}
```

### Pre-push
Runs before `git push`.

**Actions:**
1. Runs test suite
2. Attempts to fix failures
3. Blocks push if fixes fail

**Configuration:**
```json
{
  "pre_push": {
    "enabled": true,
    "run_tests": true,
    "auto_fix": true
  }
}
```

## Configuration

**Project config:** `.kimi/hooks.json`

```json
{
  "version": "1.0.0",
  "pre_commit": {
    "enabled": true,
    "auto_fix": true,
    "timeout": 120
  },
  "post_checkout": {
    "enabled": true,
    "max_files": 10
  },
  "pre_push": {
    "enabled": true,
    "run_tests": true
  },
  "global": {
    "model": "k2",
    "timeout": 300,
    "dry_run": false
  }
}
```

**Global config:** `~/.config/kimi/hooks.json`

Project config overrides global config.

## Bypassing Hooks

Emergency bypass (don't block on hook failures):

```bash
# Skip all hooks
KIMI_HOOKS_SKIP=true git commit -m "urgent fix"

# Or configure bypass env var
export KIMI_HOOKS_BYPASS_VAR="KIMI_HOOKS_SKIP"
```

## Examples

### Install hooks locally

```
/kimi-hooks install
```

### Install hooks globally

```
/kimi-hooks install --global
```

### Check status

```
/kimi-hooks status
```

### Uninstall local hooks

```
/kimi-hooks uninstall
```

## Troubleshooting

**"Not a git repository"**
- Run from within a git repository
- Or use `--global` for global installation

**Hooks not running**
- Check: `git config core.hooksPath`
- Verify hooks are executable: `ls -la .git/hooks/`
- Check `.kimi/hooks.json` has `"enabled": true`

**Pre-commit too slow**
- Reduce `max_file_size_kb` in config
- Disable for specific files in `.kimi/hooks.json`
- Use `KIMI_HOOKS_SKIP=true` for quick commits

**Hook failures blocking git**
- Hooks return 0 on skip (don't block)
- Pre-push still fails after auto-fix (by design)
- Check logs in `.kimi/hooks.log`

## Dry Run Mode

Test hooks without making changes:

```json
{
  "global": {
    "dry_run": true
  }
}
```

Shows what Kimi would do without executing.

## See Also

- @.claude/CLAUDE.md — Complete command reference
- @.claude/skills/kimi-delegation/SKILL.md — Delegation patterns
- `cat hooks/README.md` — Detailed hook documentation
```

Ensure:
1. All three hooks (pre-commit, post-checkout, pre-push) are documented
2. Configuration options are explained
3. Bypass mechanism is documented
4. Dry-run mode is explained
5. Troubleshooting covers common issues
  </action>
  <verify>[ -f .claude/commands/kimi/kimi-hooks.md ] && grep -q "pre-commit" .claude/commands/kimi/kimi-hooks.md && grep -q "KIMI_HOOKS_SKIP" .claude/commands/kimi/kimi-hooks.md</verify>
  <done>kimi-hooks.md created with complete hooks command documentation</done>
</task>

</tasks>

<verification>
- [ ] kimi-mcp.md exists and documents all actions
- [ ] kimi-hooks.md exists and documents all actions
- [ ] Both files have usage examples
- [ ] Both files have troubleshooting sections
- [ ] Configuration options are documented
- [ ] Files follow existing slash command patterns
</verification>

<success_criteria>
1. /kimi-mcp command documented with start/setup/status actions
2. /kimi-hooks command documented with install/uninstall/status actions
3. All hook types (pre-commit, post-checkout, pre-push) explained
4. Configuration files and options documented
5. Troubleshooting sections help resolve common issues
6. Both commands follow existing documentation patterns
</success_criteria>

<output>
After completion, create `.planning/phases/11-integration-distribution/11-03-SUMMARY.md`
</output>
