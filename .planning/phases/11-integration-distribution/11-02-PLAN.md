---
phase: 11-integration-distribution
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - .claude/CLAUDE.md
  - .claude/CLAUDE.md.kimi-section
autonomous: true

must_haves:
  truths:
    - CLAUDE.md contains v2.0 slash commands section
    - All new commands documented with usage examples
    - Kimi delegation section updated with model selection info
    - Quick reference table for all commands
  artifacts:
    - path: .claude/CLAUDE.md
      provides: Complete v2.0 command reference
      min_lines: 150
  key_links:
    - from: CLAUDE.md
      to: .claude/commands/kimi/kimi-mcp.md
      via: @-reference
    - from: CLAUDE.md
      to: .claude/commands/kimi/kimi-hooks.md
      via: @-reference
---

<objective>
Update CLAUDE.md with new v2.0 slash commands and enhanced Kimi delegation documentation.

Purpose: Provide Claude Code users with complete reference for all v2.0 features including MCP, hooks, and model selection.
Output: Comprehensive CLAUDE.md with v2.0 command reference, updated delegation patterns, and quick-start guide.
</objective>

<execution_context>
@~/.config/opencode/get-shit-done/workflows/execute-plan.md
@~/.config/opencode/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/REQUIREMENTS.md

# Current CLAUDE.md files
@.claude/CLAUDE.md.kimi-section

# Existing slash commands for reference
@.claude/commands/kimi/kimi-analyze.md
@.claude/commands/kimi/kimi-trace.md
@.claude/commands/kimi/kimi-verify.md
@.claude/commands/kimi/kimi-audit.md

# SKILL.md for delegation patterns
@.claude/skills/kimi-delegation/SKILL.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create comprehensive CLAUDE.md with v2.0 commands</name>
  <files>.claude/CLAUDE.md</files>
  <action>
Create new .claude/CLAUDE.md (or update if exists) with the following structure:

```markdown
# Claude Code Integration Guide

Multi-Agent Workflow v2.0 — Claude architects, Kimi implements.

---

## Quick Reference

| Command | Purpose | When to Use |
|---------|---------|-------------|
| `/kimi-analyze` | Deep codebase analysis | Understanding unfamiliar code |
| `/kimi-trace` | Trace logic across files | Finding where functionality lives |
| `/kimi-verify` | Verify implementation | Checking changes meet requirements |
| `/kimi-audit` | Security/quality audit | Reviewing for issues |
| `/kimi-mcp` | MCP server operations | Starting/configuring MCP |
| `/kimi-hooks` | Git hooks management | Installing/managing hooks |

---

## Kimi R&D Subagent

**Division of labor:**
- **Claude (Architect):** Design, plan, review, coordinate, decide
- **Kimi (Developer):** Implement, debug, refactor, test, execute

### Model Selection (v2.0)

The system intelligently selects between K2 and K2.5:

| Task Type | Model | Examples |
|-----------|-------|----------|
| Routine | K2 | Refactoring, tests, debugging, APIs |
| Creative/UI | K2.5 | Components, styling, UX, animations |

**Override:** Set `KIMI_FORCE_MODEL=k2.5` to force specific model.

### Delegation Patterns

**Always delegate:**
- Feature implementation from your specs
- Bug fixes and debugging
- Code refactoring
- Test writing
- Multi-file changes you've designed

**Always keep:**
- Architecture decisions
- Design reviews and approvals
- User communication
- Strategic planning

---

## Slash Commands

### Analysis Commands

#### `/kimi-analyze [directory] [question]`
Deep codebase analysis with 1M+ token context.

**Example:**
```
/kimi-analyze src/auth "How is JWT authentication implemented?"
```

**What it does:**
1. Kimi analyzes the specified directory
2. Returns structured findings with file:line references
3. Claude uses findings to guide implementation

---

#### `/kimi-trace [pattern]`
Trace code patterns across the codebase.

**Example:**
```
/kimi-trace "function.*handleAuth"
```

---

#### `/kimi-verify [requirements]`
Verify implementation against requirements.

**Example:**
```
/kimi-verify "All API endpoints require authentication"
```

---

#### `/kimi-audit [scope]`
Security and quality audit.

**Example:**
```
/kimi-audit src/auth
```

---

### MCP Commands (v2.0)

#### `/kimi-mcp [action]`
Manage MCP server for external tool integration.

**Actions:**
- `start` - Start MCP server (reads JSON-RPC from stdin)
- `setup` - Configure MCP for Claude Code
- `status` - Check MCP server status

**Example:**
```
/kimi-mcp start
```

**Use when:**
- External tools need to invoke Kimi
- Building integrations with other AI systems
- Using Kimi via MCP protocol

See: @.claude/commands/kimi/kimi-mcp.md

---

### Hooks Commands (v2.0)

#### `/kimi-hooks [action]`
Manage git hooks for auto-delegation.

**Actions:**
- `install` - Install hooks to current repo
- `install --global` - Install hooks globally
- `uninstall` - Remove hooks
- `status` - Check hook status

**Example:**
```
/kimi-hooks install
```

**Use when:**
- Setting up auto-delegation on git operations
- Configuring pre-commit auto-fixes
- Managing hook configuration

See: @.claude/commands/kimi/kimi-hooks.md

---

## Roles Reference

| Role | Type | Best For |
|------|------|----------|
| `implementer` | Action | Feature implementation |
| `debugger` | Action | Bug investigation |
| `refactorer` | Action | Code restructuring |
| `simplifier` | Action | Complexity reduction |
| `reviewer` | Analysis | Code review |
| `auditor` | Analysis | Quality audit |
| `security` | Analysis | Security review |

---

## Environment Variables

| Variable | Purpose | Default |
|----------|---------|---------|
| `KIMI_FORCE_MODEL` | Override auto-selection | (none) |
| `KIMI_HOOKS_SKIP` | Bypass hooks | `false` |
| `KIMI_MCP_MODEL` | MCP default model | `k2` |
| `KIMI_MCP_TIMEOUT` | MCP timeout | `300` |

---

## Workflow Examples

### Implementing a Feature

1. **Research:** `/kimi-analyze src "How are features structured?"`
2. **Design:** (Claude) Plan implementation approach
3. **Implement:** Delegate to Kimi with implementer role
4. **Verify:** `/kimi-verify "Feature works as specified"`

### Debugging an Issue

1. **Trace:** `/kimi-trace "error pattern"`
2. **Analyze:** `/kimi-analyze src "What causes this error?"`
3. **Fix:** Delegate to Kimi with debugger role
4. **Verify:** `/kimi-verify "Issue is resolved"`

---

## Configuration

### Project-level
- `.kimi/config` - Project configuration
- `.kimi/hooks.json` - Hook settings

### Global
- `~/.config/kimi-workflow/config.yaml` - Global settings
- `~/.config/kimi-mcp/config.json` - MCP configuration

---

## Troubleshooting

**Kimi command not found:**
- Ensure `~/.local/bin` is in PATH
- Run `export PATH="$HOME/.local/bin:$PATH"`

**Hooks not running:**
- Check `git config core.hooksPath`
- Verify hooks are executable
- Check `.kimi/hooks.json` enablement

**MCP server errors:**
- Verify jq is installed: `jq --version`
- Check config syntax: `cat ~/.config/kimi-mcp/config.json | jq .`

---

*Multi-Agent Workflow v2.0*
```

Ensure:
1. All v1.0 commands are preserved
2. New v2.0 commands (/kimi-mcp, /kimi-hooks) are documented
3. Model selection is explained
4. Environment variables are listed
5. Workflow examples are practical
6. Troubleshooting section covers common issues
  </action>
  <verify>grep -q "/kimi-mcp" .claude/CLAUDE.md && grep -q "/kimi-hooks" .claude/CLAUDE.md && grep -q "K2 vs K2.5" .claude/CLAUDE.md</verify>
  <done>CLAUDE.md contains all v2.0 commands, model selection guide, and troubleshooting</done>
</task>

<task type="auto">
  <name>Task 2: Update .claude/CLAUDE.md.kimi-section</name>
  <files>.claude/CLAUDE.md.kimi-section</files>
  <action>
Update the kimi-section file to include v2.0 features:

```markdown
## Kimi R&D Subagent

**Division of labor:** Claude = Brain (architect, coordinator, reviewer), Kimi = Hands (developer, implementer, debugger)

**Workflow:** Design (Claude) -> Implement (Kimi) -> Review (Claude) -> Verify (Kimi)

## Model Selection (v2.0)

Auto-selects K2 for routine tasks, K2.5 for creative/UI:

| Model | Best For | File Patterns |
|-------|----------|---------------|
| K2 | Refactoring, tests, APIs | .py, .js, .go, .rs |
| K2.5 | UI components, styling | .tsx, .jsx, .css, .vue |

**Override:** `KIMI_FORCE_MODEL=k2.5 ./skills/kimi.agent.wrapper.sh ...`

## Delegation Rules

**Delegate to Kimi:** Feature implementation, bug fixes, refactoring, test writing, multi-file changes you've designed.

**Keep for yourself:** Architecture decisions, design reviews, approvals, user communication, strategic planning.

| Task | Command |
|------|---------|
| Implement | `./skills/kimi.agent.wrapper.sh -r implementer "build X per spec"` |
| Debug | `./skills/kimi.agent.wrapper.sh -r debugger "fix bug in Y"` |
| Refactor | `./skills/kimi.agent.wrapper.sh -r refactorer "restructure Z"` |
| Review | `./skills/kimi.agent.wrapper.sh -r reviewer "review changes"` |
| Security | `./skills/kimi.agent.wrapper.sh -r security "audit auth flow"` |
| Verify | `./skills/kimi.agent.wrapper.sh -t verify --diff "check changes"` |

## Slash Commands

**Analysis:** `/kimi-analyze` | `/kimi-trace` | `/kimi-verify` | `/kimi-audit`

**MCP (v2.0):** `/kimi-mcp` — MCP server operations

**Hooks (v2.0):** `/kimi-hooks` — Git hooks management

## Roles

**Action (full tools):** `implementer` `debugger` `refactorer` `simplifier`

**Analysis (read-only):** `reviewer` `auditor` `security`

## v2.0 Features

- **Auto-model selection:** `--auto-model` flag chooses K2/K2.5
- **Cost estimation:** Shows token cost before delegation
- **MCP server:** External tool integration via `kimi-mcp start`
- **Git hooks:** Auto-delegation on commit/push via `kimi-hooks install`
```

This file is the concise reference appended to prompts.
  </action>
  <verify>grep -q "v2.0" .claude/CLAUDE.md.kimi-section && grep -q "/kimi-mcp" .claude/CLAUDE.md.kimi-section && grep -q "/kimi-hooks" .claude/CLAUDE.md.kimi-section</verify>
  <done>CLAUDE.md.kimi-section updated with v2.0 features and new commands</done>
</task>

</tasks>

<verification>
- [ ] CLAUDE.md contains /kimi-mcp command documentation
- [ ] CLAUDE.md contains /kimi-hooks command documentation
- [ ] Model selection table is present
- [ ] Environment variables section exists
- [ ] Troubleshooting section covers common issues
- [ ] CLAUDE.md.kimi-section is concise but complete
</verification>

<success_criteria>
1. CLAUDE.md documents all v2.0 slash commands
2. Model selection (K2 vs K2.5) is clearly explained
3. Quick reference table includes all commands
4. Environment variables are documented
5. Troubleshooting section helps users resolve issues
6. CLAUDE.md.kimi-section provides concise reference
</success_criteria>

<output>
After completion, create `.planning/phases/11-integration-distribution/11-02-SUMMARY.md`
</output>
