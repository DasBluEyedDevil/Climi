---
phase: 04-developer-experience
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - skills/kimi.agent.wrapper.sh
autonomous: true
must_haves:
  truths:
    - User can run `-h` or `--help` and see comprehensive documentation
    - Help output includes all wrapper flags, roles, and templates
    - Help shows examples of common usage patterns
    - User knows `--thinking` is available as a passthrough flag
  artifacts:
    - path: skills/kimi.agent.wrapper.sh
      provides: Enhanced usage() function with dynamic role/template listing
      min_lines: 50
  key_links:
    - from: usage()
      to: list_available_roles()
      via: function call
      pattern: "roles=\\$\\(list_available_roles\\)"
    - from: usage()
      to: list_available_templates()
      via: function call
      pattern: "templates=\\$\\(list_available_templates\\)"
---

<objective>
Implement enhanced help output and document the thinking flag pass-through capability.

Purpose: Users need comprehensive documentation to discover available options, roles, and templates. The help system should be self-documenting and show real available resources dynamically.

Output: Updated `usage()` function in wrapper script with:
- Comprehensive flag documentation (wrapper + passthrough)
- Dynamic enumeration of available roles and templates
- Usage examples section
- Clear distinction between wrapper flags and Kimi CLI passthrough flags
</objective>

<execution_context>
@~/.config/opencode/get-shit-done/workflows/execute-plan.md
@~/.config/opencode/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/04-developer-experience/04-RESEARCH.md
@skills/kimi.agent.wrapper.sh
</context>

<tasks>

<task type="auto">
  <name>Task 1: Update usage() function with comprehensive help</name>
  <files>skills/kimi.agent.wrapper.sh</files>
  <action>
Replace the existing usage() function (lines 283-301) with an enhanced version that includes:

1. **Header section**: Script name and brief description
2. **Wrapper Options section**: All wrapper-specific flags with descriptions
   - -r, --role ROLE
   - -m, --model MODEL  
   - -w, --work-dir PATH
   - -t, --template TPL
   - --diff
   - --dry-run (document as "Show command without executing")
   - --verbose (document as "Show wrapper debug output")
   - -h, --help
3. **Kimi CLI Options (pass-through) section**: Document flags that pass through
   - --thinking / --no-thinking
   - -y, --yes, --yolo
   - --print
   - Note that unknown flags are passed through
4. **Environment Variables section**: Document KIMI_PATH
5. **Dynamic Roles section**: Call list_available_roles() and display results
6. **Dynamic Templates section**: Call list_available_templates() and display results
7. **Examples section**: 4-5 common usage examples

Use the exact pattern from RESEARCH.md section "Enhanced Help with Dynamic Content" (lines 240-298).

All output must go to stderr (>&2). Exit with code 0.
  </action>
  <verify>Run `skills/kimi.agent.wrapper.sh --help` and verify:
- Header shows script name and description
- All wrapper flags are documented
- Pass-through flags section exists with --thinking documented
- Available roles are listed (if any exist)
- Available templates are listed (if any exist)
- Examples section shows 4+ usage patterns
- Output goes to stderr (redirect stdout and confirm content still appears)</verify>
  <done>Enhanced usage() function displays comprehensive help with dynamic role/template enumeration and usage examples</done>
</task>

<task type="auto">
  <name>Task 2: Verify --thinking passthrough and document in comments</name>
  <files>skills/kimi.agent.wrapper.sh</files>
  <action>
1. Verify the passthrough mechanism (lines 327-332) already handles --thinking correctly
2. Add a comment near the passthrough case statement documenting that --thinking is handled via passthrough:
   ```bash
   # Passthrough: handles --thinking, --no-thinking, and other kimi CLI flags
   ```
3. Update the script header comment (lines 1-10) to mention --thinking as an example of passthrough flags

No code changes needed to the passthrough logic itself - just documentation updates.
  </action>
  <verify>Run `skills/kimi.agent.wrapper.sh --dry-run -r reviewer --thinking "test"` and verify:
- Command shows --thinking in the constructed command
- No errors about unknown flag

Also verify the script header comment mentions --thinking.</verify>
  <done>--thinking flag is verified working via passthrough and documented in comments</done>
</task>

</tasks>

<verification>
- [ ] `kimi.agent.wrapper.sh --help` shows comprehensive documentation
- [ ] Help output includes all wrapper flags
- [ ] Help output includes passthrough flags section with --thinking
- [ ] Available roles are dynamically listed
- [ ] Available templates are dynamically listed
- [ ] Examples section exists with multiple usage patterns
- [ ] Script header comments mention --thinking as passthrough example
</verification>

<success_criteria>
1. User can run `-h` or `--help` and see documentation of all flags, roles, and templates (WRAP-15)
2. User knows `--thinking` is available and how it works (WRAP-09)
3. Help distinguishes between wrapper flags and Kimi CLI passthrough flags
4. Dynamic enumeration shows actual available roles and templates
</success_criteria>

<output>
After completion, create `.planning/phases/04-developer-experience/04-01-SUMMARY.md`
</output>
