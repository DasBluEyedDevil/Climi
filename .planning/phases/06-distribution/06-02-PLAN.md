---
phase: 06-distribution
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - kimi.ps1
autonomous: true
user_setup: []

must_haves:
  truths:
    - "Windows users can invoke the wrapper from PowerShell via kimi.ps1"
    - "kimi.ps1 resolves bash path and delegates to kimi.agent.wrapper.sh"
    - "kimi.ps1 passes all arguments through to the bash wrapper"
  artifacts:
    - path: "kimi.ps1"
      provides: "PowerShell shim for Windows"
      min_lines: 30
  key_links:
    - from: "kimi.ps1"
      to: "skills/kimi.agent.wrapper.sh"
      via: "bash invocation"
      pattern: "kimi\\.agent\\.wrapper\\.sh"
---

<objective>
Create PowerShell shim for Windows users to invoke the bash wrapper.

Purpose: Enable Windows users to use the Kimi integration without switching to bash.
Output: A PowerShell script that resolves bash and delegates to the wrapper.
</objective>

<execution_context>
@~/.config/opencode/get-shit-done/workflows/execute-plan.md
@~/.config/opencode/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@skills/kimi.agent.wrapper.sh
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create kimi.ps1 PowerShell shim</name>
  <files>kimi.ps1</files>
  <action>
Create `kimi.ps1` in the project root (or skills/ directory to match wrapper location):

**Header:**
```powershell
# kimi.ps1 -- PowerShell shim for kimi.agent.wrapper.sh
# Resolves bash path on Windows and delegates all arguments to the bash wrapper.
#
# Usage: kimi.ps1 [OPTIONS] PROMPT
# All options and arguments are passed through to kimi.agent.wrapper.sh
```

**Bash resolution logic (in order):**
1. Check for Git Bash: `$env:ProgramFiles\Git\bin\bash.exe`
2. Check for WSL bash: `wsl.exe bash` (test with `wsl --status`)
3. Check for MSYS2: `$env:MSYS2_ROOT\usr\bin\bash.exe`
4. Check for Cygwin: `$env:CYGWIN_ROOT\bin\bash.exe`
5. Check PATH for bash.exe
6. If none found: show error with install suggestions, exit 1

**Script location resolution:**
- Use `$PSScriptRoot` to find the script's directory
- Wrapper path: `$PSScriptRoot\kimi.agent.wrapper.sh` (if in same dir)
- Or: `$PSScriptRoot\..\skills\kimi.agent.wrapper.sh` (if in parent)

**Argument handling:**
- Capture all arguments: `$args`
- Handle arguments with spaces properly (quote them for bash)
- Build bash command line

**Invocation:**
```powershell
& $BashPath -c "$WrapperPath $ArgumentString"
```

**Exit code propagation:**
- Capture bash exit code: `$LASTEXITCODE`
- Exit with same code: `exit $LASTEXITCODE`

**Error messages:**
- "Error: bash not found. Install Git for Windows, WSL, or MSYS2."
- "Error: kimi.agent.wrapper.sh not found at {path}"
  </action>
  <verify>
```powershell
# Script exists
Test-Path kimi.ps1

# Has bash resolution
Select-String -Path kimi.ps1 -Pattern "Git.*bash|WSL|MSYS"

# Has argument handling
Select-String -Path kimi.ps1 -Pattern "args"
```
  </verify>
  <done>
kimi.ps1 exists with 30+ lines
Resolves bash from Git Bash, WSL, MSYS2, Cygwin, or PATH
Passes all arguments through to wrapper
Propagates exit code from wrapper
Shows helpful error if bash not found
  </done>
</task>

</tasks>

<verification>
Script exists:
```bash
test -f kimi.ps1 && echo "kimi.ps1 exists"
```

Contains bash resolution:
```bash
grep -E "(Git.*bash|WSL|MSYS)" kimi.ps1
```

Contains argument forwarding:
```bash
grep -i "args" kimi.ps1
```
</verification>

<success_criteria>
- kimi.ps1 exists with 30+ lines
- Resolves bash from multiple sources (Git Bash, WSL, MSYS2, Cygwin, PATH)
- Passes all arguments through to kimi.agent.wrapper.sh
- Propagates exit code
- Shows helpful error if bash not found
- Requirement DIST-05 satisfied
</success_criteria>

<output>
After completion, create `.planning/phases/06-distribution/06-02-SUMMARY.md`
</output>
