---
phase: 06-distribution
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - install.sh
  - uninstall.sh
autonomous: true
user_setup: []

must_haves:
  truths:
    - "User can run install.sh and all components are installed to ~/.claude/"
    - "install.sh supports --global, --local, and --target flags for install location"
    - "install.sh checks for kimi CLI and shows install instructions if missing"
    - "install.sh detects existing installation and offers backup"
    - "User can run uninstall.sh and all components are cleanly removed"
  artifacts:
    - path: "install.sh"
      provides: "Installation script with multi-target support"
      min_lines: 100
    - path: "uninstall.sh"
      provides: "Clean uninstallation script"
      min_lines: 50
  key_links:
    - from: "install.sh"
      to: "skills/kimi.agent.wrapper.sh"
      via: "file copy operation"
      pattern: "kimi\\.agent\\.wrapper\\.sh"
    - from: "install.sh"
      to: ".kimi/agents/*.yaml"
      via: "directory copy operation"
      pattern: "\\.kimi/agents"
---

<objective>
Create install.sh and uninstall.sh scripts for multi-platform installation.

Purpose: Enable users to install the entire Kimi integration with one command.
Output: Two bash scripts that handle installation and clean removal of all components.
</objective>

<execution_context>
@~/.config/opencode/get-shit-done/workflows/execute-plan.md
@~/.config/opencode/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@skills/kimi.agent.wrapper.sh
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create install.sh with multi-target support</name>
  <files>install.sh</files>
  <action>
Create `install.sh` in the project root with the following features:

**Header and constants:**
- Shebang: `#!/usr/bin/env bash`
- set -euo pipefail
- SCRIPT_VERSION="1.0.0"
- MIN_KIMI_VERSION="1.7.0" (matches wrapper)
- DEFAULT_TARGET="$HOME/.claude"

**Command-line options:**
- `--global` or `-g`: Install to ~/.claude/ (default)
- `--local` or `-l`: Install to current directory .claude/
- `--target PATH` or `-t PATH`: Install to custom directory
- `--force` or `-f`: Overwrite without backup prompt
- `--help` or `-h`: Show usage

**Pre-flight checks (in order):**
1. Check for kimi CLI using same logic as wrapper (KIMI_PATH env, then PATH)
2. If not found: show platform-specific install instructions (same as wrapper), exit 1
3. Check kimi version, warn if below minimum (same as wrapper)
4. Check if target directory exists and has prior installation
5. If prior installation detected: prompt for backup (unless --force)

**Backup logic:**
- Detect prior installation by checking for skills/kimi.agent.wrapper.sh in target
- If detected: create backup as {target}.backup.{timestamp}
- Show backup location to user

**Installation steps:**
1. Create directory structure:
   - {target}/skills/
   - {target}/commands/kimi/
   - {target}/.kimi/agents/
   - {target}/.kimi/templates/
2. Copy files:
   - skills/kimi.agent.wrapper.sh -> {target}/skills/
   - .claude/commands/kimi/*.md -> {target}/commands/kimi/
   - .claude/skills/kimi-delegation/SKILL.md -> {target}/skills/kimi-delegation/
   - .kimi/agents/*.yaml -> {target}/.kimi/agents/
   - .kimi/templates/*.md -> {target}/.kimi/templates/
3. Make wrapper executable: chmod +x {target}/skills/kimi.agent.wrapper.sh
4. Create {target}/.kimi-version file with MIN_KIMI_VERSION

**Success output:**
- Show installed components count
- Show target directory
- Show quick start command example
- Remind user to add CLAUDE.md.kimi-section to their CLAUDE.md

**Error handling:**
- Exit 1 if kimi not found
- Exit 2 if copy fails
- Exit 3 if permission denied
  </action>
  <verify>
```bash
# Script exists and is executable
test -x install.sh && echo "install.sh is executable"

# Has required functions
grep -c "check.*kimi" install.sh
grep -c "backup" install.sh
grep -c "DEFAULT_TARGET" install.sh

# Has help
./install.sh --help 2>&1 | head -5
```
  </verify>
  <done>
install.sh exists with 100+ lines
Supports --global, --local, --target, --force, --help
Checks for kimi CLI with install instructions
Detects existing installation and offers backup
Creates proper directory structure and copies all components
  </done>
</task>

<task type="auto">
  <name>Task 2: Create uninstall.sh for clean removal</name>
  <files>uninstall.sh</files>
  <action>
Create `uninstall.sh` in the project root:

**Header:**
- Shebang: `#!/usr/bin/env bash`
- set -euo pipefail

**Command-line options:**
- `--target PATH` or `-t PATH`: Uninstall from custom directory (default: ~/.claude)
- `--dry-run`: Show what would be removed without removing
- `--help` or `-h`: Show usage

**Removal steps:**
1. Check if installation exists (look for skills/kimi.agent.wrapper.sh)
2. If not found: report "No Kimi integration found at {target}", exit 0
3. Remove components:
   - {target}/skills/kimi.agent.wrapper.sh
   - {target}/skills/kimi-delegation/ (directory)
   - {target}/commands/kimi/ (directory)
   - {target}/.kimi/agents/ (directory)
   - {target}/.kimi/templates/ (directory)
   - {target}/.kimi-version (file)
4. Clean up empty directories:
   - Remove {target}/.kimi if empty
   - Remove {target}/skills if empty
   - Do NOT remove {target} itself (user may have other Claude Code plugins)

**Dry-run mode:**
- Show each file/directory that would be removed
- Prefix each line with "[DRY-RUN] Would remove: "
- Exit 0 without removing anything

**Success output:**
- Show count of removed components
- Confirm clean removal
  </action>
  <verify>
```bash
# Script exists and is executable
test -x uninstall.sh && echo "uninstall.sh is executable"

# Has dry-run support
grep -c "dry.run" uninstall.sh

# Has help
./uninstall.sh --help 2>&1 | head -5
```
  </verify>
  <done>
uninstall.sh exists with 50+ lines
Supports --target, --dry-run, --help
Removes all Kimi integration components
Does not remove parent directories or other plugins
Dry-run shows what would be removed
  </done>
</task>

</tasks>

<verification>
Both scripts exist and are executable:
```bash
ls -la install.sh uninstall.sh
```

install.sh has required features:
```bash
grep -E "(--global|--local|--target|--force)" install.sh | wc -l
# Should be >= 4
```

uninstall.sh has dry-run:
```bash
grep "dry" uninstall.sh
```
</verification>

<success_criteria>
- install.sh exists with 100+ lines
- install.sh supports --global, --local, --target, --force flags
- install.sh checks for kimi CLI with platform-specific instructions
- install.sh backs up existing installation before overwrite
- uninstall.sh exists with 50+ lines
- uninstall.sh supports --target and --dry-run flags
- uninstall.sh cleanly removes all components without affecting other plugins
- Requirements DIST-01, DIST-02, DIST-03, DIST-04 satisfied
</success_criteria>

<output>
After completion, create `.planning/phases/06-distribution/06-01-SUMMARY.md`
</output>
