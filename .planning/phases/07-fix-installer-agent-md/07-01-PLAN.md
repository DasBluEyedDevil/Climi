---
phase: 07-fix-installer-agent-md
plan: 01
type: execute
wave: 1
depends_on: []
files_modified: [install.sh]
autonomous: true
gap_closure: true

must_haves:
  truths:
    - "Agent MD files are copied during installation"
    - "Role invocation works after fresh install"
  artifacts:
    - path: "install.sh"
      provides: "Agent MD file copying"
      contains: "*.md"
  key_links:
    - from: "install.sh"
      to: ".kimi/agents/*.md"
      via: "cp command"
      pattern: "cp.*\\.kimi/agents.*\\.md"
---

<objective>
Fix install.sh to copy agent system prompt MD files alongside YAML agent definitions.

Purpose: Without MD files, kimi CLI fails to load agents because `system_prompt_path` references are unresolved.
Output: Updated install.sh that copies both *.yaml and *.md from .kimi/agents/
</objective>

<execution_context>
@~/.config/opencode/get-shit-done/workflows/execute-plan.md
@~/.config/opencode/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/v1.0-MILESTONE-AUDIT.md
@install.sh (lines 463-467 specifically)
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add agent MD file copying to install.sh</name>
  <files>install.sh</files>
  <action>
After line 467 (after the YAML copy block), add a new block that copies *.md files:

```bash
# Copy Kimi agent system prompts (MD files)
if [ -d "$SCRIPT_DIR/.kimi/agents" ] && ls "$SCRIPT_DIR/.kimi/agents/"*.md &> /dev/null 2>&1; then
    cp "$SCRIPT_DIR/.kimi/agents/"*.md "$TARGET_DIR/.kimi/agents/"
    echo -e "  ${GREEN}✓${NC} Copied Kimi agent prompts ($(ls -1 "$SCRIPT_DIR/.kimi/agents/"*.md 2>/dev/null | wc -l) files)"
fi
```

This mirrors the exact pattern used for YAML files (lines 463-467) for consistency.
  </action>
  <verify>grep -A5 "Copy Kimi agent system prompts" install.sh shows the new block</verify>
  <done>install.sh contains cp command for .kimi/agents/*.md files</done>
</task>

<task type="auto">
  <name>Task 2: Verify installation flow</name>
  <files>N/A (verification only)</files>
  <action>
1. Run install.sh in dry-run or to a temp directory to verify the new copy command is reached
2. Confirm both YAML and MD files would be copied
3. Optionally: Check that the count displayed is correct (should show 7 MD files for the 7 agent roles)
  </action>
  <verify>
Run: ./install.sh --help (to confirm script still parses correctly)
Run: bash -n install.sh (syntax check)
Grep: grep -c "Copied Kimi agent" install.sh should return 2 (YAMLs + MDs)
  </verify>
  <done>install.sh passes syntax check and shows two agent copy messages (YAML + MD)</done>
</task>

</tasks>

<verification>
- [ ] install.sh contains cp command for *.md files after the *.yaml copy block
- [ ] Both copy blocks use identical pattern (consistency)
- [ ] install.sh --help still works (no syntax errors introduced)
- [ ] grep confirms two "Copied Kimi agent" lines exist
</verification>

<success_criteria>
1. install.sh copies .kimi/agents/*.md files to target directory
2. Installation → Role Invocation flow no longer breaks
3. No regression in existing install.sh functionality
</success_criteria>

<output>
After completion, create `.planning/phases/07-fix-installer-agent-md/07-01-SUMMARY.md`
</output>
